from django.http import JsonResponse
from django.db import transaction
from rest_framework.parsers import JSONParser
import requests
from ..Views.V_CommFunction import *
from ..Serializer.S_Reports import *
from ..models import *

def ReadFTPFile():
    print("ReadFTPFile Function Call")
    url_query = MC_CronJobSettings.objects.filter(id=3).values('URL')
    API_URL = url_query[0]['URL']
    print(API_URL)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
    headers = {
        "Content-Type": "application/json"  
    }
    auth = ("superadmin", "1234")

    try:
        response = requests.get(API_URL, auth=auth, headers=headers)
        print("response data :",response)
        response_data = response.json()
        print("after convert in json:",response_data)
        
        if response_data.get("StatusCode") == 200:
            print("API call success:", response_data.get("Message"))
        else:
            print("API call issue:", response_data.get("Message"))

    except requests.exceptions.RequestException as e:
        print("API request failed:", str(e))
        return JsonResponse({
            'StatusCode': 500,
            'Status': False,
            'Message': 'API request failed',
            'Data': []
        })
